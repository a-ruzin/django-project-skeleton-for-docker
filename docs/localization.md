## Локализация

### 1. Оборачивание строк в `gettext_lazy`
Для того чтобы строка могла быть переведена, оборачиваем её в `gettext_lazy`.

```python
from django.utils.translation import gettext_lazy as _
some_string = _('Привет мир!')
```
#### Правила работы с f строками
Обычный `.format` и `f''` не сможет перевестись, так как в таком случае, строка сначала соберётся из составных частей, а только потом будет произведён поиск строки для перевода.
Поэтому делаем так:
```python
some_string = _('Пропущено %s сообщений') % msg_count
```
Если же нужно вставить в строку несколько данных:
```python
some_sting = _('Заявок, ожидающих обработку: %(requests_count)s\n%(manager)s обрати внимание!') % {
   'requests_count': requests_count,
   'manager': manager.username,
}
```

### 2. Подготовка переводов

> **Памятка!**
>
> `make messages ARGS="<lang>"` - генерирует файл перевода app/locale/<lang>/LC_MESSAGES/django.po<br>
> `make translatemessages ARGS="<lang>"` - вносит в этот файл строки перевода<br>
> `make cleanmessages ARGS="<lang>"` - удаляет флажки `#, fuzzy` из файла перевода<br>
> `make compilemessages ARGS="<lang>"` - компилирует файл перевода в .mo файл<br>

#### 2.1. Генерация файла перевода

```bash
make messages ARGS="<lang>"
```
Эту команду можно запускать несколько раз, в т.ч. для нахождения
новых текстов, добавленных в исходный код. При нахождении новых строк,
они будут добавлены в файл перевода с флагом `#, fuzzy`, что означает,
что строка не была переведена. Эти строки нужно будет перевести
вручную или автоматически. Кроме этого, в файле перевода будут добавлены
ссылки на строки в исходном коде, откуда они были взяты.

#### 2.2. Перевод

Перевод можно сделать автоматически или вручную.

##### 2.2.1. Автоматический перевод с помощью DeepL
В `.env` устанавливаем `DEEPL_AUTH_KEY`. Если вы установили или изменили его,
то потребуется перезапустить контейнеры:
```bash
make translatemessages ARGS="<lang>"
```
Команда переводит только строки, помеченные `#, fuzzy`, и добавляет
к ним комментарий `# Translated with django-translatemessages`.
При последующих запусках строки с таким комментарием не будут переводиться повторно.
Если вы хотите, чтобы строка была переведена повторно, то нужно удалить
комментарий `# Translated with django-translatemessages` и добавить флаг '#, fuzzy'.

##### 2.2.2. Перевод вручную

Откройте файл перевода в любом удобном текстовом редакторе.
Файл имеет структуру вида:
```aiignore
...
#: base/models/core_model.py:14
msgid "passive"
msgstr "passive"

#: base/models/core_model.py:15
#, fuzzy
msgid "active"
msgstr ""
...
```

Вам нужно заполнить `msgstr` строку переводом строки `msgid`, для разделов,
помеченным `#, fuzzy`. Этот флаг, означает что строка не была переведена ранее
(либо новая либо изменена старая). Если вам не хватает контекста - можно
заглянуть в исходный код, по ссылке, указанной в строке `#:`.

#### 2.3. Очистка .po файлов (опционально)

Когда вы сочли, что все строки переведены, можно удалить флаг `#, fuzzy` и
ссылки на исходный код. Для этого запустите команду:
```bash
make cleanmessages ARGS="<lang>"
```

#### 2.4. Компилируем переводы
Джанго работает с компилированными файлами, поэтому после перевода
нужно создать .mo файлы перевода
```bash
make compilemessages ARGS="<lang>"
```
